# シングルページ・アプリケーション（SPA）
## 定義(原理)
SPAとは「Single Page Application」の略で、単一のページでコンテンツの切り替えを行うWebアプリケーションのアーキテクチャ。Webブラウザ側でページの移動を行わず、最初に読み込んだWebページ上のスクリプトがサーバとの通信や画面遷移を行う方式。

SPAではブラウザによるページ遷移を行わずにコンテンツの切り替えなどを行うことで、ユーザー体験（UX）を大きく向上させることができる。

従来のWeb ページでは遷移時にページ全体が書き換わるが、SPAでは　 JavaScript を用いてページ内の HTML の一部を差し替えてコンテンツを切り替えている。

これにより、ブラウザの挙動に縛られないUIの実現やパフォーマンスの向上が可能になる。

## 特徴(メリデメ、従来技術との違い、留意点)
### メリット
#### 通常のWeb ページでは実現できないユーザー体験を実現できる
ブラウザの挙動に縛られないことから、より幅広い UI を実現することができるため、ユーザー体験を向上させることができる。

例えば、ブラウザによるページ遷移が発生しないことにより、音楽を試聴しながらブラウジングを行うことができる音楽配信サービスのようなものも実現可能。 

また、Twitter や Facebook などのようにプッシュ型の通知を提示することもできます。Facebookのように「チャットウィンドウは表示したまま表示しているコンテンツを変更する」などの機能を実現することができる。

他にもなめらかなアニメーションによるページ遷移や、見栄えの良いローディングも独自に実装することが可能である。

#### 高速なページ遷移を実現できる。
従来のWebページでは、ページ遷移の度に遷移先のHTML全体をサーバーから取得するため読み込みに時間がかかる。しかし、SPAでは遷移先のページを構成するために必要最小限のデータのみを取得し、ブラウザでHTMLを構築するため、従来のWebページと比較してページ遷移が高速になる。

また、ブラウザによるページ遷移が発生しないため、独自にキャッシュ機能や先行ローディングの機能を実装することでさらなる速度向上を図ることも可能。

#### ネイティブアプリの代わりとして提供することができる。
SPA によって実現可能なユーザー体験はネイティブアプリと比較しても遜色のないものとなるため、Web アプリとして作成したものをネイティブアプリとして流用することができる。

最近ではプログレッシブウェブアプリ（Progressive Web Apps: PWA)という考え方がGoogleから提唱されており、Web の最新の技術を用いてWebとネイティブアプリの両方の利点を持ったアプリを作ることが着目されている。

この手法を用いれば、オフラインでのページ閲覧、プッシュ通知、ホーム画面からの起動といったネイティブアプリならではの機能をWebアプリで実現することができる。

### デメリット
#### 実装コストが大幅に増える。
SPAでは今までブラウザに処理を任せていた部分を実装する必要があるため、開発コストがかさむ。例えば、ブラウザの「戻る・進む」の履歴管理、ページごとの URL の割り当て、リンククリック時のローディング表示などが挙げられる。

一般的な機能であれば、それがすでに実装されたライブラリがある場合が多いが、アプリの要件に合わせるために独自に実装しなければならないケースも多々ある。

こういった機能はUI上のささいな点である場合がほとんどだが、実装を怠ると使い勝手に大きく影響してしまうため、SPAを採用する上では対応は必須といえる。

また、ただ動くものを作るだけでは通常のWebページと比較してSEOの面で不利になるため、サーバーサイドレンダリング(SSR)という技術で対策をしなければならない場合もある。

SPAはJavaScriptでデータを取得し、HTMLを構築するというステップでページを表示することから、ほとんどの場合クローリングの対象外である。SSRを導入するためにはサーバーサイドの開発も必要となり、対応しているライブラリも限られているため一般的に実装コストが大きく増加する。

#### 初期ローディングにかかる時間が増える。
ページの切り替えは高速になるが、JavaScript のコード量が増えるのに加えて今までサーバー側で行っていた HTML の生成をブラウザで行うことになるため、 初期ローディングにかかる時間は増える。こちらも SSR を用いることで高速化は可能だが、その分の実装コストがかかってしまう。

#### 開発者が少ない。
SPAを開発したことのある開発者は、一般的なWebページの制作者に比べ圧倒的に少ない。

SPAを開発するには、通常の Web　ページよりも規模が大きいコードを書く必要があることから、Webページの制作スキルに加えて　JavaScript　およびその周辺技術に関する幅広い知識と高度な設計スキルが求められる。

SPA を構築するためにはなんらかのライブラリ、フレームワークを使用することは避けられないため、それらに対する理解も必須となる。また、後々までメンテナンスが可能なコードを書くための設計も必須といえる。

### 従来技術との違い
操作の度にページ全体の再読み込みを行う通常の方式に比べ、ページ上の必要な部分だけを更新するため軽快に動作させることができる。通常のアプリケーションソフト（ネイティブアプリ）に近い表示・操作感を実現することができ、ページが分かれている場合に実現しにくいオフラインでの動作なども実装しやすい。

原理上すべてのページや動作状態が単一のURL/URIによって提供されるため、外部から特定の表示状態を指定してアクセスする（URLによって状態を識別・同定する）ことができない。データ処理などの機能が主体のWebアプリケーションでは問題にならないが、コンテンツ提供の要素を含むサービスではSEOやアクセス解析などで不利な構成である。
## 利用シーン
SPAはその特性上、ユーザーが頻繁にページ遷移やコンテンツの操作を行う滞在時間の長いサービスに適している。

例えば、データ可視化サービスやチケットの座席指定などはユーザーが繰り返し検索を行うため、SPAに向いている。

### 留意点
ブログのように直帰率が比較的高いサービスはSPAにはあまり適していないといえる。

SPAは従来のブラウザが行っていた挙動をJavaScriptで実装するため、サービスに最初にアクセスしたときの読み込みやセットアップにより多くの時間を必要とする。

直帰率が高いサービスにSPAを採用しても、アクセス時にかかる時間が増加するだけであまりメリットは無い。
